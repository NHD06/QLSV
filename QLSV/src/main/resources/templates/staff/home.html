<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management Dashboard</title>
    <link rel="stylesheet" href="./test.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body style="background-color: #00000014;">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #00000014;
        }
        .container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .table th, .table td {
            vertical-align: middle;
            text-align: center;
        }
        .table th {
            background-color: #f2f2f2;
        }
        
        .status-active {
            color: green;
        }
        .student-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        .sidebar {
          margin-top: 26px;
            /* height: 100vh; */
            width: 250px;
            background-color: #ffffff;
            padding: 20px;
            position: fixed;
        }
        .sidebar a {
            color: #667580;
            padding: 10px;
            text-decoration: none;
            display: block;
            font-size: 18px;
        }
        .sidebar a:hover {
            background-color: #EEEEEE;
        }
        .sidebar .submenu a {
            padding-left: 30px;
            font-size: 16px;
        }
        .sidebar .submenu {
            display: none;
            flex-direction: column;
        }
        .toggle-btn {
            cursor: pointer;
        }
        .wraper {
            margin-top: 56px;
            display: flex;
            justify-content: center;
        }
        .wraper{
            margin-top: 56px;
            margin-left: auto;
            margin-right: auto;
        }
        .container {
        max-width: 1200px;
        margin: 0 98.4px;
        }

        /*  */

        nav {
        background-color: #ffffff;
        }

        .nav-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        width: 1200px;
        margin-left: auto;
        margin-right: auto;
        }

        .search-container {
        position: relative;
        display: flex;
        align-items: center;
        background-color: #f2f2f2;
        border-radius: 20px;
        padding: 5px 10px;
        width: 450px;
        }

        .logo{
        margin-right: 26px;

        }
        .search-input {
        flex: 1;
        border: none;
        background-color: transparent;
        outline: none;
        font-size: 16px;
        padding: 5px;
        }

        .search-icon {
            color: #888;
            cursor: pointer;
            position: absolute;
            right: 20px;
        }

        .menu {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .menu li {
            position: relative;
            list-style-type: none;
        }

        .menu li a {
            display: block;
            color: #667580;
            text-decoration: none;
            padding: 15px 20px;
            transition: background-color 0.3s ease;
        }

        .menu li a:hover {
            background-color: #EEEEEE;
        }

        .menu li a i {
            margin-right: 5px;
        }

        .submenu {
            display: none;
            position: absolute;
            background-color: #ffffff;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .submenu li a {
            color: #667580;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
        }

        .submenu li a:hover {
            background-color: #EEEEEE;
        }

        .menu li:hover > .submenu {
            display: block;
        }

        .wraper{
            width: 1200px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
            text-align: left;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #ddd;
        }
        .close{
            position: absolute;
            top: 5px;
            right: 14px;
            font-size: 40px;
        }
        .modal-dialog{
            position: relative;
        }
        dl dt{
            width: 50%;
        }
        dl dd{
            width: 50%;
        }
        #addStudentForm {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f2f2f2;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        #addStudentForm h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        #addStudentForm label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        #addStudentForm input[type="text"],
        #addStudentForm input[type="email"],
        #addStudentForm input[type="date"],
        #addStudentForm select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 15px;
        }

        #addStudentForm input[type="submit"],
        #addStudentForm button[type="submit"] {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
            margin-left: 10px;
        }

        #addStudentForm input[type="submit"]:hover,
        #addStudentForm button[type="submit"]:hover {
            background-color: #45a049;
        }

        #addStudentForm::after {
            content: "";
            clear: both;
            display: table;
        }
    </style>
    <nav>
        <div class="nav-container">
            <div class="logo">
                <img src="./Tesst-img/sv_logo_dashboard.png" alt="">
            </div>
            <div class="search-container">
                <form method="get" action="/staff/home">
                    <input type="text" name="query" placeholder="Search by ID or Name" class="search-input" id="searchInput">
                    <div style="    right: 12px; top: 13px;" class="search-icon">
                        <button style="border: none;" type="submit"><i class="fas fa-search"></i></button>
                    </div>
                </form>
            </div>
          <ul class="menu">
            <li><a href="#"><i class="fas fa-user"></i> Profile</a></li>
            <li><a href="#"><i class="fas fa-chart-bar"></i> Báo cáo</a></li>
            <li>
              <a href="#"><i class="fas fa-cog"></i> Cài đặt</a>
              <ul class="submenu">
                <li><a href="#">Tài khoản</a></li>
                <li><a href="#">Giao diện</a></li>
                <li><a href="#">Quyền truy cập</a></li>
              </ul>
            </li>
            <li>
                <span th:text="${session.fullname}"></span>
            </li>
            <li><a href="/logout"><i class="fa-solid fa-door-open"></i></a></li>
          </ul>
        </div>
      </nav>
    <!-- End Nav -->
    <div class="col-sm-3" style="width: 230px;">
        <div class="panel panel-default">
            <div class="panel-heading">Trang chủ</div>
            <div class="panel-body">
                <ul class="nav nav-pills nav-stacked">
                    <li id="studentListTab" class="active"><a href="#" onclick="showStudentList()">Danh sách sinh viên</a></li>
                    <li><a id="showAddFormBtn" href="#" onclick="showAddStudentForm()">Nhập hồ sơ</a></li>
    
                    <li><a href="#">Sửa hồ sơ</a></li>
                    <li><a href="#">Quản lí tài khoản</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- End slide-bar -->
    <div class="wraper">
        <div class="container" id="studentList" style="display: none;">
            <h2 style="margin-bottom: 26px;">Quản lý học viên của khoa</h2>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>MSSV</th>
                        <th>Họ tên</th>
                        <th>Giới tính</th>
                        <th>Email</th>
                        <th>Số điện thoại</th>
                        <th>Địa chỉ</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="student : ${students}">
                        <td th:text="${student.studentCode}"></td>
                        <td th:text="${student.fullname}"></td>
                        <td th:text="${student.gender == 1 ? 'Nam' : 'Nữ'}"></td>
                        <td th:text="${student.email}"></td>
                        <td th:text="${student.phoneNumber}"></td>
                        <td th:text="${student.address}"></td>
                        <td>
                            <button class="btn btn-primary" data-toggle="modal" data-target="#studentModal" th:attr="data-student-id=${student.id}">Xem</button>
                            <button class="btn btn-primary edit-button" th:data-student-id="${student.id}">Sửa</button>
                            <button class="btn btn-danger delete-button" th:onclick="'deleteStudent(' + ${student.id} + ')'" >Xóa</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
<div class="modal fade" id="studentModal" tabindex="-1" role="dialog" aria-labelledby="studentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="studentModalLabel">Thông tin chi tiết sinh viên</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <dl class="row">
                    <dt class="col-sm-3">ID:</dt>
                    <dd class="col-sm-9" id="studentId"></dd>

                    <dt class="col-sm-3">MSSV:</dt>
                    <dd class="col-sm-9" id="studentCode"></dd>

                    <dt class="col-sm-3">Họ tên:</dt>
                    <dd class="col-sm-9" id="fullname"></dd>

                    <dt class="col-sm-3">Email:</dt>
                    <dd class="col-sm-9" id="email"></dd>

                    <dt class="col-sm-3">Số điện thoại:</dt>
                    <dd class="col-sm-9" id="phoneNumber"></dd>

                    <dt class="col-sm-3">Địa chỉ:</dt>
                    <dd class="col-sm-9" id="address"></dd>

                    <!-- <dt class="col-sm-3">Mã khoa:</dt>
                    <dd class="col-sm-9" id="department"></dd> -->

                    <dt class="col-sm-3">Ngày vào học:</dt>
                    <dd class="col-sm-9" id="entryDate"></dd>

                    <dt class="col-sm-3">Giới tính:</dt>
                    <dd class="col-sm-9" id="gender"></dd>

                    <dt class="col-sm-3">Trạng thái:</dt>
                    <dd class="col-sm-9" id="status"></dd>

                    <dt class="col-sm-3">Mã hồ sơ:</dt>
                    <dd class="col-sm-9" id="profileCode"></dd>

                    <dt class="col-sm-3">Mã lớp:</dt>
                    <dd class="col-sm-9" id="classCode"></dd>

                    <dt class="col-sm-3">Trình độ:</dt>
                    <dd class="col-sm-9" id="educationLevel"></dd>

                    <dt class="col-sm-3">Chuyên ngành:</dt>
                    <dd class="col-sm-9" id="major"></dd>

                    <dt class="col-sm-3">Khóa học:</dt>
                    <dd class="col-sm-9" id="course"></dd>

                    <dt class="col-sm-3">Ngày sinh:</dt>
                    <dd class="col-sm-9" id="dateOfBirth"></dd>

                    <dt class="col-sm-3">Nhóm mục tiêu:</dt>
                    <dd class="col-sm-9" id="targetGroup"></dd>

                    <dt class="col-sm-3">Nơi sinh:</dt>
                    <dd class="col-sm-9" id="birthPlace"></dd>

                    <dt class="col-sm-3">Tên ngân hàng:</dt>
                    <dd class="col-sm-9" id="bankName"></dd>

                    <dt class="col-sm-3">Tên chủ tài khoản:</dt>
                    <dd class="col-sm-9" id="accountHolderName"></dd>

                    <dt class="col-sm-3">Số tài khoản ngân hàng:</dt>
                    <dd class="col-sm-9" id="bankAccountNumber"></dd>

                    <dt class="col-sm-3">Tên cố vấn:</dt>
                    <dd class="col-sm-9" id="advisorName"></dd>

                    <dt class="col-sm-3">Số điện thoại cố vấn:</dt>
                    <dd class="col-sm-9" id="advisorPhone"></dd>

                    <dt class="col-sm-3">Email cố vấn:</dt>
                    <dd class="col-sm-9" id="advisorEmail"></dd>
                </dl>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Form thêm sinh viên -->
<div id="addStudentForm" style="display: none;">
    <!-- Các trường nhập thông tin sinh viên ở đây -->
    <form action="/addStudent" method="post">
        <label for="studentCode">MSSV:</label><br>
        <input type="text" id="studentCode" name="studentCode"><br>

        <label for="fullname">Họ Tên:</label><br>
        <input type="text" id="fullname" name="fullname"><br>

        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email"><br>

        <label for="phoneNumber">Số Điện Thoại:</label><br>
        <input type="text" id="phoneNumber" name="phoneNumber"><br>

        <label for="address">Địa Chỉ:</label><br>
        <input type="text" id="address" name="address"><br>

        <label for="departmentId">Mã Khoa:</label><br>
        <input type="text" id="department" name="department"><br>

        <label for="entryDate">Ngày Vào Học:</label><br>
        <input type="date" id="entryDate" name="entryDate"><br>

        <label for="gender">Giới Tính:</label><br>
        <select id="gender" name="gender">
            <option value="1">Nam</option>
            <option value="0">Nữ</option>
        </select><br>

        <label for="status">Trạng Thái:</label><br>
        <input type="text" id="status" name="status"><br>

        <label for="profileCode">Mã Hồ Sơ:</label><br>
        <input type="text" id="profileCode" name="profileCode"><br>

        <label for="classCode">Mã Lớp:</label><br>
        <input type="text" id="classCode" name="classCode"><br>

        <label for="educationLevel">Trình Độ:</label><br>
        <input type="text" id="educationLevel" name="educationLevel"><br>

        <label for="major">Chuyên Ngành:</label><br>
        <input type="text" id="major" name="major"><br>

        <label for="course">Khóa Học:</label><br>
        <input type="text" id="course" name="course"><br>

        <label for="dateOfBirth">Ngày Sinh:</label><br>
        <input type="date" id="dateOfBirth" name="dateOfBirth"><br>

        <label for="targetGroup">Nhóm Mục Tiêu:</label><br>
        <input type="text" id="targetGroup" name="targetGroup"><br>

        <label for="birthPlace">Nơi Sinh:</label><br>
        <input type="text" id="birthPlace" name="birthPlace"><br>

        <label for="bankName">Ngân Hàng:</label><br>
        <input type="text" id="bankName" name="bankName"><br>

        <label for="accountHolderName">Tên Chủ Tài Khoản:</label><br>
        <input type="text" id="accountHolderName" name="accountHolderName"><br>

        <label for="bankAccountNumber">Số Tài Khoản Ngân Hàng:</label><br>
        <input type="text" id="bankAccountNumber" name="bankAccountNumber"><br>

        <label for="advisorName">Tên Cố Vấn:</label><br>
        <input type="text" id="advisorName" name="advisorName"><br>

        <label for="advisorPhone">Số Điện Thoại Cố Vấn:</label><br>
        <input type="text" id="advisorPhone" name="advisorPhone"><br>

        <label for="advisorEmail">Email Cố Vấn:</label><br>
        <input type="email" id="advisorEmail" name="advisorEmail"><br>

        <input type="submit" value="Submit">
    </form>
</div>

<!-- Modal chỉnh sửa sinh viên -->
<div class="modal fade" id="editStudentModal" tabindex="-1" role="dialog" aria-labelledby="editStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">Sửa thông tin sinh viên</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editStudentForm">
                    <input type="hidden" id="editStudentId" name="id">
                    <div class="form-group">
                        <label for="editStudentCode">Mã sinh viên</label>
                        <input type="text" class="form-control" id="editStudentCode" name="studentCode">
                    </div>
                    <div class="form-group">
                        <label for="editFullname">Họ và tên</label>
                        <input type="text" class="form-control" id="editFullname" name="fullname">
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" class="form-control" id="editEmail" name="email">
                    </div>
                    <div class="form-group">
                        <label for="editPhoneNumber">Số điện thoại</label>
                        <input type="text" class="form-control" id="editPhoneNumber" name="phoneNumber">
                    </div>
                    <div class="form-group">
                        <label for="editAddress">Địa chỉ</label>
                        <input type="text" class="form-control" id="editAddress" name="address">
                    </div>
                    <!-- Các trường khác cần thiết -->
                    <button type="submit" class="btn btn-primary">Lưu thay đổi</button> 
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
    // Hiển thị chi tiết sinh viên trong modal
    $('#studentModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var studentId = button.data('student-id');

        console.log('Student ID: ' + studentId); // Debugging line

        $.ajax({
            url: '/getStudentDetails/' + studentId,
            type: 'GET',
            dataType: 'json',
            success: function (response) {
                console.log(response); // Debugging line

                $('#studentId').text(response.id);
                $('#studentCode').text(response.studentCode);
                $('#fullname').text(response.fullname);
                $('#email').text(response.email);
                $('#phoneNumber').text(response.phoneNumber);
                $('#address').text(response.address);
                $('#department').val(response.department);
                $('#entryDate').text(response.entryDate);
                $('#gender').text(response.gender);
                $('#status').text(response.status);
                $('#profileCode').text(response.profileCode);
                $('#classCode').text(response.classCode);
                $('#educationLevel').text(response.educationLevel);
                $('#major').text(response.major);
                $('#course').text(response.course);
                $('#dateOfBirth').text(response.dateOfBirth);
                $('#targetGroup').text(response.targetGroup);
                $('#birthPlace').text(response.birthPlace);
                $('#bankName').text(response.bankName);
                $('#accountHolderName').text(response.accountHolderName);
                $('#bankAccountNumber').text(response.bankAccountNumber);
                $('#advisorName').text(response.advisorName);
                $('#advisorPhone').text(response.advisorPhone);
                $('#advisorEmail').text(response.advisorEmail);
            },
            error: function (xhr, status, error) {
                console.error('Error fetching student details:', error);
            }
        });
    });

    // Hiển thị modal chỉnh sửa sinh viên với dữ liệu đã điền sẵn
    $(document).on('click', '.edit-button', function () {
        var studentId = $(this).data('student-id');

        $.ajax({
            url: '/getStudentDetails/' + studentId,
            type: 'GET',
            dataType: 'json',
            success: function (response) {
                $('#editStudentId').val(response.id);
                $('#editStudentCode').val(response.studentCode);
                $('#editFullname').val(response.fullname);
                $('#editEmail').val(response.email);
                $('#editPhoneNumber').val(response.phoneNumber);
                $('#editAddress').val(response.address);
                // Điền các trường khác nếu cần
                $('#editStudentModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.error('Error fetching student details:', error);
            }
        });
    });

    // Xử lý form chỉnh sửa sinh viên
    $('#editStudentForm').submit(function (event) {
        event.preventDefault();
        var formData = $(this).serialize();

        $.ajax({
            url: '/updateStudent',
            type: 'POST',
            data: formData,
            success: function (response) {
                $('#editStudentModal').modal('hide');
                alert('Student information updated successfully.');
                // Tùy chọn: Cập nhật danh sách sinh viên hoặc cập nhật dòng trong bảng
            },
            error: function (xhr, status, error) {
                console.error('Error updating student details:', error);
            }
        });
    });
});



    function showStudentList() {
        // Hiển thị danh sách sinh viên và ẩn form nhập hồ sơ
        document.getElementById("studentList").style.display = "block";
        document.getElementById("addStudentForm").style.display = "none";
    }

    function showAddStudentForm() {
        // Ẩn danh sách sinh viên và hiển thị form nhập hồ sơ
        document.getElementById("studentList").style.display = "none";
        document.getElementById("addStudentForm").style.display = "block";
    }
    function showStudentList() {
                // Hiển thị danh sách sinh viên và ẩn form nhập hồ sơ
                document.getElementById("studentList").style.display = "block";
                document.getElementById("addStudentForm").style.display = "none";
            }
        
            function showAddStudentForm() {
                // Ẩn danh sách sinh viên và hiển thị form nhập hồ sơ
                document.getElementById("studentList").style.display = "none";
                document.getElementById("addStudentForm").style.display = "block";
            }
            function deleteStudent(studentId) {
                if (confirm('Bạn có chắc chắn muốn xóa sinh viên này không?')) {
                    $.ajax({
                        url: '/deleteStudent/' + studentId,
                        type: 'POST',
                        success: function(response) {
                            // Xử lý sau khi xóa thành công, ví dụ: reload trang
                            location.reload();
                        },
                        error: function(xhr, status, error) {
                            console.error('Error deleting student:', error);
                            // Xử lý lỗi nếu cần thiết
                        }
                    });
                }
            }

</script>

</body>
</html>
